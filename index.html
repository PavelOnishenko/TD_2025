<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Minimal Tower Defense</title>
  <style>
    body { margin: 0; background: #fff; }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="450"></canvas>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const enemy = {
      x: 0,
      y: 365,
      w: 30,
      h: 30,
      speed: 50
    };

    const tower = {
      x: 400,
      y: 280,
      w: 40,
      h: 40,
      range: 120
    };

    const projectiles = [];
    const projectileSpeed = 200;
    const projectileRadius = 6;
    let lastShot = 0;

    let lastTime = 0;

    function update(timestamp) {
      const dt = (timestamp - lastTime) / 1000;
      lastTime = timestamp;

      enemy.x += enemy.speed * dt;

      const towerCenterX = tower.x + tower.w / 2;
      const towerCenterY = tower.y + tower.h / 2;
      const enemyCenterX = enemy.x + enemy.w / 2;
      const enemyCenterY = enemy.y + enemy.h / 2;
      const dx = enemyCenterX - towerCenterX;
      const dy = enemyCenterY - towerCenterY;
      const dist = Math.hypot(dx, dy);

      if (dist <= tower.range && timestamp - lastShot >= 1000) {
        const angle = Math.atan2(dy, dx);
        projectiles.push({
          x: towerCenterX,
          y: towerCenterY,
          vx: Math.cos(angle) * projectileSpeed,
          vy: Math.sin(angle) * projectileSpeed
        });
        lastShot = timestamp;
      }

      projectiles.forEach(p => {
        p.x += p.vx * dt;
        p.y += p.vy * dt;
      });

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // draw road
      ctx.fillStyle = '#888';
      ctx.fillRect(0, 380, canvas.width, 20);

      // draw tower range
      ctx.beginPath();
      ctx.arc(
        tower.x + tower.w / 2,
        tower.y + tower.h / 2,
        tower.range,
        0,
        Math.PI * 2
      );
      ctx.strokeStyle = 'rgba(0,0,255,0.3)';
      ctx.stroke();

      // draw tower
      ctx.fillStyle = 'blue';
      ctx.fillRect(tower.x, tower.y, tower.w, tower.h);

      // draw enemy
      ctx.fillStyle = 'red';
      ctx.fillRect(enemy.x, enemy.y, enemy.w, enemy.h);

      // draw projectiles
      ctx.fillStyle = 'black';
      projectiles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, projectileRadius, 0, Math.PI * 2);
        ctx.fill();
      });

      requestAnimationFrame(update);
    }

    requestAnimationFrame(update);
  </script>
</body>
</html>
